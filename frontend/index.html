<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ShopEase | Home</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Navbar -->
  <header class="navbar">
    <div class="logo">üõçÔ∏è MyShop</div>
    <nav>
      <ul id="navLinks">
        <li><a href="index.html">Home</a></li>
        <li><a href="cart.html">Cart üõí (<span id="cartCount">0</span>)</a></li>
        <li id="authLinks">
          <a href="login.html" id="loginLink">Login</a> /
          <a href="register.html" id="registerLink">Register</a>
        </li>
        <li id="userSection" style="display: none;">
          <span id="userName"></span>
          <button id="logoutBtn">Logout</button>
        </li>
      </ul>
    </nav>
  </header>

  <!-- Product List -->
  <section id="products" class="product-list"></section>
   <footer class="footer">
    <div class="footer-content">
      <p>¬© 2025 MyShop. All rights reserved.</p>
    
      <p>Made with ‚ù§Ô∏è by PK Groups Team</p>
    </div>
  </footer>

  <script>
    const productsDiv = document.getElementById("products");

    // --- Load products from backend ---
    async function loadProducts() {
      try {
        const res = await fetch("http://localhost:5000/api/products");
        const data = await res.json();

        productsDiv.innerHTML = data.map(p => `
          <div class="product-card">
            <img src="${p.image}" alt="${p.name}">
            <h3>${p.name}</h3>
            <p>‚Çπ${p.price}</p>
            <button onclick='addToCart(${JSON.stringify(p)})'>Add to Cart</button>
          </div>
        `).join('');
      } catch (err) {
        console.error("Error loading products:", err);
        productsDiv.innerHTML = "<p>‚ö†Ô∏è Failed to load products.</p>";
      }
    }

    // --- Add to Cart ---
    function addToCart(product) {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];

      // Check if product already in cart
      const existingItem = cart.find(item => item._id === product._id);
      if (existingItem) {
        existingItem.quantity = (existingItem.quantity || 1) + 1;
      } else {
        product.quantity = 1;
        cart.push(product);
      }

      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartCount();
      alert(`${product.name} added to cart!`);
    }

    // --- Update Cart Count ---
    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      const totalItems = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
      document.getElementById("cartCount").textContent = totalItems;
    }

    // --- Handle User Login/Logout ---
    const userData = JSON.parse(localStorage.getItem("user"));
    const userSection = document.getElementById("userSection");
    const authLinks = document.getElementById("authLinks");

    if (userData && userData.name) {
      document.getElementById("userName").textContent = `üëã Hello, ${userData.name}`;
      userSection.style.display = "inline-block";
      authLinks.style.display = "none";
    }

    const logoutBtn = document.getElementById("logoutBtn");
    if (logoutBtn) {
      logoutBtn.addEventListener("click", () => {
        localStorage.removeItem("user");
        alert("You have been logged out!");
        window.location.href = "index.html";
      });
    }

    // --- Init ---
    loadProducts();
    updateCartCount();
  </script>
</body>
</html>
